<!DOCTYPE html>
<html>
<head>
  <title>Password Recovery - Cahaya Az Zahra</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container forgot-password-page">
    <h1>Password Recovery</h1>
    
    <div class="input-group">
      <input type="tel" id="recoveryPhone" 
             placeholder="Registered Phone Number" 
             pattern="^(673\d{7,}|60\d{9,})$" 
             required>
      <div class="error-message" id="phoneRecoveryError"></div>
    </div>
    
    <div class="input-group">
      <input type="email" id="recoveryEmail" 
             placeholder="Registered Email Address" 
             required>
      <div class="error-message" id="emailRecoveryError"></div>
    </div>
    
    <button onclick="handlePasswordRecovery()">Send Temporary Password</button>
   <button class="secondary-btn" onclick="safeRedirect('login.html')"style="margin-top: 10px;">Back to Login</button>
  </div>

  <script src="scripts/app.js"></script>
  <script>
 
const GAS_URL = 'https://script.google.com/macros/s/AKfycby-QiM-4V-aTyaBr_tBhjc043VXkaks-zJy1JfbZvqBSG-GESuj2rb1zSv5WDswpXlc/exec';

    async function handlePasswordRecovery() {
    const phone = document.getElementById('recoveryPhone').value.trim();
    const email = document.getElementById('recoveryEmail').value.trim();
    
    // Clear errors
    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

    // Validate inputs
    let isValid = true;
    if (!validatePhone(phone)) {
      showError('Invalid phone format', 'phoneRecoveryError');
      isValid = false;
    }
    if (!validateEmail(email)) {
      showError('Invalid email format', 'emailRecoveryError');
      isValid = false;
    }
    if (!isValid) return;

    try {
      const response = await fetch(GAS_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          action: 'initiatePasswordReset',
          phone: phone,
          email: email
        })
      });

      // Handle HTTP errors
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.message || `HTTP error! ${response.status}`);
      }

      const data = await response.json();
      
      if (data.success) {
        alert('Temporary password sent! Check your email.');
        safeRedirect('login.html');
      } else {
        showError(data.message || 'Recovery failed');
      }
    } catch (error) {
      console.error('Recovery Error:', error);
      showError(`Failed: ${error.message}`);
    }
  }
  </script>
</body>
</html>
