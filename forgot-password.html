<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Password Reset - Cahaya Az Zahra Enterprise</title>
  <link rel="stylesheet" href="styles/main.css">
  <style>
    .password-reset-page {
      max-width: 500px;
      margin: 2rem auto;
      animation: fadeIn 0.3s ease-in;
    }

    .password-rules {
      font-size: 0.9em;
      color: var(--gold);
      margin: 1rem 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 480px) {
      .password-reset-page {
        padding: 1rem;
      }
      
      input {
        padding: 12px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container password-reset-page">
    <h1>Reset Password</h1>
    
    <div class="input-group">
      <label for="newPassword">New Password</label>
      <input type="password" 
             id="newPassword" 
             placeholder="Enter new password"
             required
             pattern="^(?=.*[A-Z])(?=.*\d).{6,}$">
      <div class="password-rules">6+ characters, 1 uppercase letter, 1 number</div>
      <div class="error-message" id="newPasswordError"></div>
    </div>

    <div class="input-group">
      <label for="confirmNewPassword">Confirm New Password</label>
      <input type="password" 
             id="confirmNewPassword" 
             placeholder="Confirm new password"
             required>
      <div class="error-message" id="confirmPasswordError"></div>
    </div>

    <button id="resetBtn" class="gold-btn">Reset Password</button>
    <button class="secondary-btn" onclick="handleLogout()" style="margin-top: 1rem;">
      Cancel & Return to Login
    </button>
  </div>

  <script src="scripts/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Session validation
      const userData = checkSession();
      if (!userData || !userData.tempPassword) {
        safeRedirect('login.html');
        return;
      }

      // Event listeners
      const resetBtn = document.getElementById('resetBtn');
      const newPassInput = document.getElementById('newPassword');
      const confirmPassInput = document.getElementById('confirmNewPassword');

      if (resetBtn && newPassInput && confirmPassInput) {
        resetBtn.onclick = async (e) => {
          e.preventDefault();
          
          if (newPassInput.value !== confirmPassInput.value) {
            showError('Passwords do not match', 'confirmPasswordError');
            return;
          }

          if (!validatePassword(newPassInput.value)) {
            showError('Invalid password format', 'newPasswordError');
            return;
          }

          await handlePasswordReset();
        };
      } else {
        console.error('Password reset elements missing');
        safeRedirect('login.html');
      }
    });
  </script>
</body>
</html>
