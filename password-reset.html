<!DOCTYPE html>
<html>
<head>
  <title>Reset Password - Cahaya Az Zahra</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container password-reset-page">
    <h1>Reset Password</h1>
    
    <div class="input-group">
      <input type="password" id="newPassword" 
             placeholder="New password (6+ chars, 1 uppercase, 1 number)"
             pattern="^(?=.*[A-Z])(?=.*\d).{6,}$" 
             required>
      <div class="error-message" id="newPasswordError"></div>
    </div>
    
    <div class="input-group">
      <input type="password" id="confirmNewPassword" 
             placeholder="Confirm new password" 
             required>
      <div class="error-message" id="confirmPasswordError"></div>
    </div>
    
    <button onclick="handlePasswordReset()">Reset Password</button>
    <button class="secondary-btn" onclick="handleLogout()">Cancel</button>
  </div>

  <script src="scripts/app.js"></script>
  <script>
    const RESET_GAS_URL = GAS_URL;

    function handlePasswordReset() {
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmNewPassword').value;
      const userData = JSON.parse(sessionStorage.getItem('userData'));

      if (!validatePassword(newPassword)) {
        showError('Invalid password format', 'newPasswordError');
        return;
      }

      if (newPassword !== confirmPassword) {
        showError('Passwords mismatch', 'confirmPasswordError');
        return;
      }

      fetch(RESET_GAS_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          action: 'updatePassword',
          phone: userData.phone,
          newPassword: newPassword
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          sessionStorage.removeItem('userData');
          alert('Password updated! Please login');
          showLogin();
        } else {
          showError(data.message);
        }
      })
      .catch(error => showError('Reset failed: ' + error.message));
    }
  </script>
</body>
</html>
